<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Itsbad Store - Toko Online Premium</title>
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõçÔ∏è</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary: #7c3aed;
      --primary-dark: #5b21b6;
      --secondary: #f59e0b;
      --success: #10b981;
      --danger: #ef4444;
      --light: #f8fafc;
      --dark: #1e293b;
    }
    
    body { 
      font-family: 'Inter', 'Poppins', sans-serif; 
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      overflow-x: hidden;
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--primary-dark); }
    
    .loader { 
      border: 3px solid rgba(124, 58, 237, 0.1); 
      border-radius: 50%; 
      border-top: 3px solid var(--primary); 
      width: 20px; 
      height: 20px; 
      animation: spin 1s linear infinite; 
    }
    
    @keyframes spin { 
      0% { transform: rotate(0deg); } 
      100% { transform: rotate(360deg); } 
    }
    
    .glass-nav { 
      background: rgba(255, 255, 255, 0.92); 
      backdrop-filter: blur(12px); 
      border-bottom: 1px solid rgba(124, 58, 237, 0.08); 
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03); 
    }
    
    .card-shadow { 
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.03); 
      transition: all 0.3s ease; 
    }
    
    .card-shadow:hover { 
      box-shadow: 0 10px 30px rgba(124, 58, 237, 0.12), 0 1px 3px rgba(0, 0, 0, 0.05); 
      transform: translateY(-2px); 
    }
    
    .slide-up { animation: slideUp 0.4s ease-out; }
    @keyframes slideUp { 
      from { transform: translateY(20px); opacity: 0; } 
      to { transform: translateY(0); opacity: 1; } 
    }
    
    .fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { 
      from { opacity: 0; } 
      to { opacity: 1; } 
    }
    
    .pulse-animation { animation: pulse 2s infinite; }
    @keyframes pulse { 
      0%, 100% { opacity: 1; } 
      50% { opacity: 0.7; } 
    }
    
    .gradient-bg { background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%); }
    .gradient-bg-dark { background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%); }
    
    .modal-overlay { 
      background: rgba(0, 0, 0, 0.5); 
      backdrop-filter: blur(6px); 
    }
    
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Custom Animations */
    .float-animation { animation: float 3s ease-in-out infinite; }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .ripple { 
      position: relative; 
      overflow: hidden; 
    }
    .ripple:after { 
      content: ''; 
      position: absolute; 
      top: 50%; 
      left: 50%; 
      width: 0; 
      height: 0; 
      border-radius: 50%; 
      background: rgba(255, 255, 255, 0.3); 
      transform: translate(-50%, -50%); 
      transition: width 0.6s, height 0.6s; 
    }
    .ripple:active:after { 
      width: 300px; 
      height: 300px; 
    }
    
    /* Shimmer Effect */
    .shimmer { 
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); 
      background-size: 200% 100%; 
      animation: shimmer 1.5s infinite; 
    }
    @keyframes shimmer { 
      0% { background-position: -200% 0; } 
      100% { background-position: 200% 0; } 
    }
    
    /* Badge Notification */
    .badge-dot { 
      position: absolute; 
      top: 0; 
      right: 0; 
      width: 8px; 
      height: 8px; 
      background-color: var(--danger); 
      border-radius: 50%; 
      border: 2px solid white; 
    }
    
    /* Smooth Transitions */
    .transition-all { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
  </style>
</head>
<body class="flex justify-center min-h-screen text-slate-800">

  <div class="w-full max-w-md bg-white min-h-screen relative flex flex-col overflow-hidden shadow-xl">
    
    <!-- NAVBAR ENHANCED -->
    <div class="glass-nav p-4 z-50 sticky top-0 flex justify-between items-center h-16">
      <div class="flex items-center gap-3">
        <div onclick="window.showProfile()" class="cursor-pointer relative">
          <div id="userAvatar" class="w-10 h-10 rounded-full bg-gradient-to-br from-slate-100 to-slate-200 flex items-center justify-center overflow-hidden border-2 border-white shadow-md">
            <i class="fas fa-user text-slate-500"></i>
          </div>
          <div class="badge-dot hidden" id="userNotification"></div>
        </div>
        <div>
          <h1 class="text-sm font-bold leading-tight text-slate-800" id="shopNameDisplay">Itsbad Store</h1>
          <p class="text-xs text-slate-500" id="userNameDisplay">Menunggu Login...</p>
        </div>
      </div>
      
      <div class="flex items-center gap-3">
        <button onclick="window.toggleCart()" class="relative p-2 text-slate-600 hover:text-indigo-600 transition-all ripple">
          <i class="fas fa-shopping-bag text-xl"></i>
          <span id="cartCount" class="absolute top-0 right-0 bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full shadow-sm hidden font-bold">0</span>
        </button>
        <button onclick="window.toggleSearch()" class="p-2 text-slate-600 hover:text-indigo-600 transition-all">
          <i class="fas fa-search text-lg"></i>
        </button>
      </div>
    </div>

    <!-- SEARCH BAR (Hidden by Default) -->
    <div id="searchBar" class="hidden p-4 bg-white border-b border-slate-100">
      <div class="relative">
        <input type="text" id="searchInput" placeholder="Cari produk..." class="w-full p-3 pl-10 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        <i class="fas fa-search absolute left-3 top-3.5 text-slate-400"></i>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="flex-1 overflow-y-auto p-4 bg-gradient-to-b from-slate-50 to-white relative no-scrollbar" id="mainContainer">

      <!-- AUTH OVERLAY - ENHANCED -->
      <div id="authOverlay" class="fixed inset-0 bg-gradient-to-br from-indigo-50 via-white to-purple-50 z-60 flex flex-col items-center justify-center p-6 fade-in">
        <div class="w-24 h-24 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-3xl flex items-center justify-center mb-6 float-animation shadow-lg">
          <i class="fas fa-store text-4xl text-indigo-600"></i>
        </div>
        <h2 class="text-3xl font-bold text-slate-800 mb-2">Selamat Datang</h2>
        <p class="text-slate-500 text-center mb-10 max-w-xs">Masuk untuk mulai belanja dan nikmati pengalaman berbelanja terbaik</p>
          
        <button onclick="window.loginGoogle()" class="w-full max-w-xs bg-white border border-slate-200 py-4 rounded-xl font-semibold text-slate-700 flex items-center justify-center gap-3 shadow-lg hover:shadow-xl hover:bg-slate-50 transition-all card-shadow mb-4 ripple">
          <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5"> 
          <span>Masuk dengan Google</span>
        </button>
          
        <button onclick="window.loginGuest()" class="w-full max-w-xs bg-gradient-to-r from-slate-800 to-slate-900 text-white py-4 rounded-xl font-semibold hover:from-slate-900 hover:to-slate-800 transition-all shadow-lg ripple">
          Lanjut sebagai Tamu
        </button>
          
        <div class="mt-10 p-4 bg-blue-50 rounded-xl border border-blue-100 max-w-xs">
          <p class="text-xs text-blue-600 text-center">
            <i class="fas fa-info-circle mr-1"></i>
            Pastikan "Google Sign-in" sudah diaktifkan di Firebase Console
          </p>
        </div>
      </div>

      <!-- SHOP PAGE - ENHANCED -->
      <div id="page-shop" class="fade-in">
        <!-- Hero Banner -->
        <div class="gradient-bg text-white p-5 rounded-2xl mb-6 relative overflow-hidden card-shadow">
          <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-10 -mt-10"></div>
          <div class="absolute bottom-0 left-0 w-24 h-24 bg-white opacity-10 rounded-full -ml-10 -mb-10"></div>
          
          <div class="relative z-10">
            <h2 class="text-2xl font-bold mb-1">Belanja Mudah & Aman</h2>
            <p class="text-indigo-100 text-sm mb-4">Bayar dengan QRIS, transaksi cepat tanpa ribet</p>
            <div class="flex items-center gap-2">
              <div class="bg-white/20 px-3 py-1 rounded-full text-xs font-semibold">
                <i class="fas fa-bolt mr-1"></i> Instant Checkout
              </div>
              <div class="bg-white/20 px-3 py-1 rounded-full text-xs font-semibold">
                <i class="fas fa-shield-alt mr-1"></i> Aman
              </div>
            </div>
          </div>
        </div>
        
        <!-- Products Grid -->
        <div class="mb-4 flex justify-between items-center">
          <h3 class="font-bold text-lg text-slate-800">Produk Tersedia</h3>
          <span class="text-xs text-slate-500 bg-slate-100 px-3 py-1 rounded-full" id="productCount">0 Produk</span>
        </div>
        
        <div id="productGrid" class="grid grid-cols-2 gap-4 pb-24">
          <!-- Loading State -->
          <div class="col-span-2">
            <div class="grid grid-cols-2 gap-4">
              <div class="bg-slate-100 rounded-2xl p-4 shimmer h-64"></div>
              <div class="bg-slate-100 rounded-2xl p-4 shimmer h-64"></div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- CART MODAL - ENHANCED -->
    <div id="cartModal" class="fixed inset-0 z-50 pointer-events-none">
      <div class="absolute inset-0 bg-black/50 opacity-0 transition-opacity duration-300 ease-out" id="cartBackdrop" onclick="window.toggleCart()"></div>
        
      <div class="absolute bottom-0 left-0 w-full bg-white rounded-t-3xl shadow-2xl transform translate-y-full transition-transform duration-300 ease-out pointer-events-auto max-h-[85vh] flex flex-col" id="cartSheet">
        <!-- Cart Header -->
        <div class="p-5 border-b border-slate-100 flex justify-between items-center">
          <div>
            <h3 class="font-bold text-xl text-slate-800">Keranjang Belanja</h3>
            <p class="text-xs text-slate-500" id="cartItemCount">0 item</p>
          </div>
          <button onclick="window.toggleCart()" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-full flex items-center justify-center text-slate-600 transition-all ripple">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <!-- Cart Items -->
        <div id="cartItems" class="flex-1 overflow-y-auto p-5 space-y-3 no-scrollbar min-h-[200px]">
          <div class="text-center text-slate-400 py-16">
            <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-shopping-bag text-2xl text-slate-300"></i>
            </div>
            <p class="font-medium text-slate-500">Keranjang belanja kosong</p>
            <p class="text-sm text-slate-400 mt-1">Tambahkan produk untuk memulai belanja</p>
          </div>
        </div>

        <!-- Cart Summary -->
        <div class="p-5 bg-gradient-to-b from-white to-slate-50 border-t border-slate-200">
          <div class="space-y-2 mb-4">
            <div class="flex justify-between text-sm">
              <span class="text-slate-500">Subtotal</span>
              <span class="font-semibold" id="cartSubtotal">Rp 0</span>
            </div>
            <div class="flex justify-between text-sm text-amber-600">
              <span>Biaya Layanan</span>
              <span class="font-semibold" id="cartFee">+ Rp 0</span>
            </div>
            <div class="border-t border-slate-200 pt-2 mt-2">
              <div class="flex justify-between text-lg font-bold text-slate-800">
                <span>Total</span>
                <span id="cartTotal">Rp 0</span>
              </div>
            </div>
          </div>
          <button onclick="window.processCheckout()" class="w-full gradient-bg text-white py-4 rounded-xl font-bold shadow-lg hover:shadow-xl hover:opacity-95 transition-all ripple flex items-center justify-center gap-2">
            <i class="fas fa-credit-card"></i> 
            <span>BAYAR SEKARANG</span>
          </button>
        </div>
      </div>
    </div>

    <!-- PAYMENT MODAL - ENHANCED -->
    <div id="paymentModal" class="fixed inset-0 bg-gradient-to-br from-slate-50 to-white z-70 hidden flex-col fade-in">
      <!-- Header -->
      <div class="p-5 border-b border-slate-100 flex items-center gap-4 bg-white">
        <button onclick="window.closePayment()" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-full flex items-center justify-center text-slate-600 transition-all ripple">
          <i class="fas fa-arrow-left"></i>
        </button>
        <div>
          <h2 class="font-bold text-lg text-slate-800">Pembayaran</h2>
          <p class="text-xs text-slate-500">Selesaikan pembayaran Anda</p>
        </div>
      </div>
      
      <!-- Payment Content -->
      <div class="flex-1 overflow-y-auto p-5 no-scrollbar">
        <!-- Total Amount Card -->
        <div class="gradient-bg-dark text-white p-5 rounded-2xl mb-6 shadow-lg relative overflow-hidden">
          <div class="absolute top-0 right-0 w-24 h-24 bg-white opacity-10 rounded-full -mr-6 -mt-6"></div>
          <p class="text-sm font-medium text-indigo-100 mb-2">Total Tagihan</p>
          <h1 class="text-3xl font-bold" id="payTotal">Rp 0</h1>
          <p class="text-xs text-indigo-200 mt-2">
            <i class="fas fa-clock mr-1"></i> Berlaku 1 jam
          </p>
        </div>

        <!-- Payment Instructions -->
        <div class="bg-white border border-slate-200 rounded-2xl p-5 mb-6 card-shadow">
          <div class="flex items-start gap-3 mb-4">
            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
              <i class="fas fa-qrcode text-green-600"></i>
            </div>
            <div>
              <h3 class="font-bold text-slate-800 mb-1">Bayar dengan QRIS</h3>
              <p class="text-sm text-slate-600">Scan QR code di bawah untuk pembayaran instan</p>
            </div>
          </div>
          
          <!-- QR Container -->
          <div id="qrContainer" class="flex justify-center min-h-[200px] items-center my-4">
            <div class="w-48 h-48 bg-slate-100 rounded-xl flex items-center justify-center shimmer"></div>
          </div>
          
          <p class="text-center text-xs text-slate-500 mt-3" id="qrNote">
            <i class="fas fa-info-circle mr-1"></i>
            Nominal otomatis terdeteksi
          </p>
        </div>

        <!-- Payment Steps -->
        <div class="bg-blue-50 border border-blue-100 rounded-2xl p-5 mb-6">
          <h4 class="font-bold text-blue-800 text-sm mb-3 flex items-center gap-2">
            <i class="fas fa-list-ol"></i> Langkah Pembayaran
          </h4>
          <div class="space-y-3">
            <div class="flex items-start gap-3">
              <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">1</div>
              <p class="text-sm text-blue-700">Scan QR Code dengan aplikasi mobile banking/e-wallet</p>
            </div>
            <div class="flex items-start gap-3">
              <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">2</div>
              <p class="text-sm text-blue-700">Pastikan nominal sesuai dengan total tagihan</p>
            </div>
            <div class="flex items-start gap-3">
              <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">3</div>
              <p class="text-sm text-blue-700">
                <span class="font-bold text-green-600">Sertakan bukti transfer</span> ketika mengirim pesan WhatsApp ke admin
              </p>
            </div>
            <div class="flex items-start gap-3">
              <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">4</div>
              <p class="text-sm text-blue-700">Tunggu konfirmasi dari admin untuk proses selanjutnya</p>
            </div>
          </div>
        </div>

        <!-- Customer Info -->
        <div class="bg-white border border-slate-200 rounded-2xl p-5 card-shadow">
          <h4 class="font-bold text-slate-800 text-sm mb-3">Informasi Pembeli</h4>
          <div class="space-y-4">
            <div>
              <label class="text-xs font-medium text-slate-500 mb-1 block">Nama Pembeli</label>
              <input type="text" id="custName" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-700 font-medium" readonly>
            </div>
            
            <div>
              <label class="text-xs font-medium text-slate-500 mb-1 block">Nomor WhatsApp</label>
              <div class="flex gap-2">
                <div class="flex items-center px-3 bg-slate-100 border border-slate-200 rounded-xl">
                  <span class="text-slate-700 font-medium">+62</span>
                </div>
                <input type="tel" id="custPhone" class="flex-1 p-3 bg-slate-50 border border-slate-200 rounded-xl" placeholder="81234567890" readonly>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Button -->
      <div class="p-5 border-t border-slate-200 bg-white">
        <div class="flex items-center justify-center gap-2 mb-3">
          <div class="w-2 h-2 bg-green-500 rounded-full pulse-animation"></div>
          <p class="text-xs text-slate-500">Klik tombol di bawah setelah melakukan pembayaran</p>
        </div>
        
        <button onclick="window.confirmPayment()" class="w-full gradient-bg text-white py-4 rounded-xl font-bold shadow-lg hover:shadow-xl hover:opacity-95 transition-all ripple flex items-center justify-center gap-3">
          <i class="fab fa-whatsapp text-xl"></i>
          <span>KONFIRMASI KE ADMIN</span>
        </button>
        
        <p class="text-center text-xs text-slate-400 mt-3">
          Pastikan Anda telah menyertakan bukti transfer di WhatsApp
        </p>
      </div>
    </div>

    <!-- CONFIRMATION MODAL (New) -->
    <div id="confirmModal" class="fixed inset-0 z-80 flex items-center justify-center p-4 hidden">
      <div class="modal-overlay absolute inset-0" onclick="closeConfirmModal()"></div>
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 slide-up relative z-10">
        <div class="text-center mb-6">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-check text-2xl text-green-600"></i>
          </div>
          <h3 class="font-bold text-xl text-slate-800 mb-2">Konfirmasi Pembayaran</h3>
          <p class="text-slate-600">Apakah Anda sudah melakukan transfer dan menyertakan bukti di WhatsApp?</p>
        </div>
        
        <div class="bg-amber-50 border border-amber-100 rounded-xl p-4 mb-6">
          <div class="flex items-start gap-3">
            <div class="w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center flex-shrink-0">
              <i class="fas fa-exclamation text-amber-600"></i>
            </div>
            <div>
              <p class="text-sm font-medium text-amber-800 mb-1">Penting!</p>
              <p class="text-xs text-amber-700">Pastikan bukti transfer sudah dilampirkan di WhatsApp untuk mempercepat proses verifikasi</p>
            </div>
          </div>
        </div>
        
        <div class="flex gap-3">
          <button onclick="closeConfirmModal()" class="flex-1 bg-slate-100 text-slate-700 py-3.5 rounded-xl font-semibold hover:bg-slate-200 transition-all">
            Belum
          </button>
          <button onclick="window.sendOrder()" class="flex-1 gradient-bg text-white py-3.5 rounded-xl font-semibold hover:opacity-95 transition-all">
            Sudah, Lanjutkan
          </button>
        </div>
      </div>
    </div>

    <!-- PROFILE MODAL - ENHANCED -->
    <div id="profileModal" class="fixed inset-0 bg-gradient-to-br from-slate-50 to-white z-80 hidden flex-col overflow-y-auto no-scrollbar">
      <!-- Profile Header -->
      <div class="sticky top-0 bg-white p-5 shadow-sm flex justify-between items-center z-10">
        <h2 class="font-bold text-xl text-slate-800">Profil Saya</h2>
        <button onclick="document.getElementById('profileModal').classList.add('hidden')" class="w-10 h-10 bg-slate-100 hover:bg-slate-200 rounded-full flex items-center justify-center text-slate-600 transition-all ripple">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- Profile Content -->
      <div class="p-5">
        <!-- Avatar Section -->
        <div class="flex flex-col items-center mb-8">
          <div class="relative mb-4">
            <div id="profileAvatar" class="w-32 h-32 rounded-full bg-gradient-to-br from-slate-200 to-slate-300 flex items-center justify-center overflow-hidden border-4 border-white shadow-xl">
              <i class="fas fa-user text-slate-400 text-5xl"></i>
            </div>
            <label for="avatarUpload" class="absolute bottom-2 right-2 w-12 h-12 gradient-bg rounded-full flex items-center justify-center text-white cursor-pointer shadow-lg hover:shadow-xl transition-all ripple">
              <i class="fas fa-camera text-sm"></i>
            </label>
            <input type="file" id="avatarUpload" accept="image/*" class="hidden">
          </div>
          <h3 class="font-bold text-2xl text-slate-800 mt-3" id="profileName">Loading...</h3>
          <p class="text-slate-500 text-sm mt-1" id="profileEmail">Loading...</p>
          <div class="flex items-center gap-2 mt-3">
            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
            <span class="text-xs text-green-600 font-medium" id="profileStatus">Online</span>
          </div>
        </div>

        <!-- Profile Form -->
        <div class="space-y-6">
          <div class="bg-white border border-slate-200 rounded-2xl p-5 card-shadow">
            <h4 class="font-bold text-slate-800 text-sm mb-4 flex items-center gap-2">
              <i class="fas fa-user-circle"></i> Informasi Pribadi
            </h4>
            
            <div class="space-y-4">
              <div>
                <label class="text-xs font-medium text-slate-500 mb-2 block">Nama Lengkap</label>
                <input type="text" id="editName" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" placeholder="Masukkan nama lengkap">
              </div>
              
              <div>
                <label class="text-xs font-medium text-slate-500 mb-2 block">Nomor WhatsApp</label>
                <div class="flex gap-2">
                  <div class="flex items-center px-3 bg-slate-100 border border-slate-200 rounded-xl">
                    <span class="text-slate-700 font-medium">+62</span>
                  </div>
                  <input type="tel" id="editPhone" class="flex-1 p-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" placeholder="81234567890">
                </div>
              </div>
              
              <div>
                <label class="text-xs font-medium text-slate-500 mb-2 block">Alamat Pengiriman</label>
                <textarea id="editAddress" class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" rows="3" placeholder="Masukkan alamat lengkap"></textarea>
              </div>
            </div>
          </div>

          <!-- Order History -->
          <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-100 rounded-2xl p-5">
            <h4 class="font-bold text-amber-800 text-sm mb-4 flex items-center gap-2">
              <i class="fas fa-history"></i> Riwayat Belanja
            </h4>
            <div id="orderHistory" class="text-sm text-amber-700">
              <div class="text-center py-6">
                <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="fas fa-receipt text-amber-500"></i>
                </div>
                <p class="font-medium text-amber-600">Belum ada riwayat pembelian</p>
                <p class="text-xs text-amber-500 mt-1">Belanja sekarang untuk melihat riwayat</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 space-y-3">
          <button onclick="window.saveProfile()" class="w-full gradient-bg text-white py-4 rounded-xl font-bold shadow-lg hover:shadow-xl hover:opacity-95 transition-all ripple flex items-center justify-center gap-3">
            <i class="fas fa-save"></i> SIMPAN PROFIL
          </button>
          
          <button onclick="window.logout()" class="w-full bg-slate-100 text-slate-700 py-4 rounded-xl font-bold hover:bg-slate-200 transition-all ripple flex items-center justify-center gap-3">
            <i class="fas fa-sign-out-alt"></i> KELUAR
          </button>
        </div>
      </div>
    </div>

    <!-- PRODUCT DETAIL MODAL - ENHANCED -->
    <div id="productDetailModal" class="fixed inset-0 z-90 hidden items-center justify-center p-4">
      <div class="modal-overlay absolute inset-0" onclick="window.closeProductDetail()"></div>
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto no-scrollbar slide-up relative z-10">
        <!-- Product Image -->
        <div id="detailImage" class="w-full h-64 bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center relative">
          <i class="fas fa-box text-8xl text-indigo-200"></i>
          <button onclick="window.closeProductDetail()" class="absolute top-4 right-4 w-10 h-10 bg-white/80 backdrop-blur-sm rounded-full flex items-center justify-center text-slate-600 hover:bg-white transition-all">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <!-- Product Info -->
        <div class="p-5">
          <div class="flex items-center justify-between mb-3">
            <div id="detailCategory" class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-bold">
              PRODUK
            </div>
            <div class="flex items-center gap-2">
              <i class="fas fa-star text-amber-400 text-sm"></i>
              <span class="text-xs text-slate-500">4.8</span>
            </div>
          </div>
          
          <h1 id="detailName" class="text-2xl font-bold text-slate-800 mb-2">Nama Produk</h1>
          <p id="detailDescription" class="text-slate-600 mb-6 leading-relaxed">Deskripsi produk akan muncul di sini.</p>
          
          <div class="flex items-end justify-between mb-8">
            <div>
              <p class="text-sm text-slate-500 mb-1">Harga</p>
              <p id="detailPrice" class="text-3xl font-bold text-slate-800">Rp 0</p>
            </div>
            <div id="detailStock" class="text-right">
              <p class="text-sm text-slate-500 mb-1">Stok Tersedia</p>
              <p class="text-xl font-bold text-slate-800">0</p>
            </div>
          </div>
          
          <div class="flex gap-3">
            <button id="detailAddToCart" onclick="window.addToCartFromDetail()" class="flex-1 bg-slate-100 text-slate-800 py-4 rounded-xl font-bold hover:bg-slate-200 transition-all ripple flex items-center justify-center gap-3">
              <i class="fas fa-cart-plus"></i> TAMBAH
            </button>
            <button onclick="window.buyNowFromDetail()" class="flex-1 gradient-bg text-white py-4 rounded-xl font-bold shadow-lg hover:shadow-xl hover:opacity-95 transition-all ripple flex items-center justify-center gap-3">
              <i class="fas fa-bolt"></i> BELI LANGGSUNG
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ADMIN PANEL (Hidden) -->
    <div id="adminPanel" class="fixed inset-0 bg-slate-50 z-90 hidden overflow-y-auto">
      <!-- Same as original, just for completeness -->
      <div class="sticky top-0 bg-white p-4 shadow-sm flex justify-between items-center z-10">
        <h2 class="font-bold text-lg">Admin Dashboard</h2>
        <button onclick="document.getElementById('adminPanel').classList.add('hidden')" class="text-sm font-bold text-red-500">Tutup</button>
      </div>
      
      <div id="adminLoginForm" class="p-10 text-center mt-20">
        <div class="w-16 h-16 bg-slate-200 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-lock text-slate-500 text-2xl"></i>
        </div>
        <h3 class="font-bold text-lg mb-4">Akses Admin</h3>
        <input type="password" id="adminPin" class="w-full p-4 rounded-xl border text-center text-xl mb-4 bg-white shadow-sm" placeholder="Masukkan PIN" maxlength="6">
        <button onclick="window.loginAdmin()" class="w-full bg-slate-800 text-white py-3 rounded-xl font-bold shadow-lg">MASUK</button>
      </div>

      <div id="adminContent" class="p-4 space-y-6 hidden">
        <!-- Admin content same as original -->
      </div>
    </div>

  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>

  <script type="module">
    // Firebase and core logic remains the same as your original code
    // Only UI/UX enhancements and removal of file upload
    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, get, child, update, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAUL2WkPlJLb8wHcSKQ_QA7GSZ5DGw94Ng",
      authDomain: "kasir-online-c22bd.firebaseapp.com",
      databaseURL: "https://kasir-online-c22bd-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "kasir-online-c22bd",
      storageBucket: "kasir-online-c22bd.firebasestorage.app",
      messagingSenderId: "1052259146588",
      appId: "1:1052259146588:web:a3f4e9c31982cbfa2dff99",
      measurementId: "G-QR6HPRX459"
    };

    const STORE_ID = "itsbad-store";
    const OWNER_WA = "6285236363128";

    let db, auth, user;
    let storeData = { name: "Itsbad Store", fee: 0, products: [] };
    let cart = JSON.parse(localStorage.getItem('myCart')) || [];
    let userProfile = JSON.parse(localStorage.getItem('userProfile')) || {};
    let currentProductDetail = null;
    
    toastr.options = { 
      "positionClass": "toast-top-center", 
      "timeOut": "2000",
      "progressBar": true,
      "closeButton": true
    };

    // UI Enhancement Functions
    window.toggleSearch = () => {
      const searchBar = document.getElementById('searchBar');
      searchBar.classList.toggle('hidden');
      if(!searchBar.classList.contains('hidden')) {
        document.getElementById('searchInput').focus();
      }
    };

    window.confirmPayment = () => {
      document.getElementById('confirmModal').classList.remove('hidden');
    };

    function closeConfirmModal() {
      document.getElementById('confirmModal').classList.add('hidden');
    };

    // Modified sendOrder function (removed file upload)
    window.sendOrder = async () => {
      // Create order summary
      let itemsList = "";
      cart.forEach(c => {
        itemsList += `‚ñ™Ô∏è ${c.name} (${c.qty}x) - Rp ${(c.qty*c.price).toLocaleString()}\n`;
      });
      
      const subtotal = cart.reduce((a, b) => a + b.qty * b.price, 0);
      const fee = parseInt(storeData.fee || 0);
      const total = subtotal + fee;
      
      // Customer info
      const custPhone = userProfile.phone ? `+62${userProfile.phone}` : "";
      const custAddress = userProfile.address || "";

      const msg = `*ORDER BARU - ITSBAD STORE*\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nüë§ ${userProfile.name}\nüì± ${custPhone}\nüìç ${custAddress}\n\n*Pesanan:*\n${itemsList}\nSubtotal: Rp ${subtotal.toLocaleString()}\nLayanan: Rp ${fee.toLocaleString()}\n*TOTAL: Rp ${total.toLocaleString()}*\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n*Harap sertakan bukti transfer di chat ini.*`;

      // Save order to database
      const orderData = {
        user: user.uid,
        userName: userProfile.name,
        items: cart.map(c => `${c.name} (${c.qty}x)`).join(', '),
        total: total,
        timestamp: Date.now(),
        status: "pending"
      };
      
      try {
        await push(ref(db, `orders/${user.uid}`), orderData);
        toastr.success("Pesanan tersimpan!");
      } catch(e) {
        console.error("Failed to save order:", e);
      }

      // Send WhatsApp message
      const url = `https://wa.me/${OWNER_WA}?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
      
      // Clear cart and show success
      cart = [];
      saveCart();
      document.getElementById('confirmModal').classList.add('hidden');
      document.getElementById('paymentModal').classList.add('hidden');
      
      toastr.success("Terima kasih! Admin akan segera memproses pesanan Anda.");
      
      // Show success message
      setTimeout(() => {
        document.getElementById('mainContainer').innerHTML = `
          <div class="flex flex-col items-center justify-center h-full p-10 text-center">
            <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6">
              <i class="fas fa-check text-4xl text-green-600"></i>
            </div>
            <h2 class="text-2xl font-bold text-slate-800 mb-3">Pesanan Berhasil!</h2>
            <p class="text-slate-600 mb-6">Admin akan menghubungi Anda via WhatsApp untuk konfirmasi.</p>
            <button onclick="location.reload()" class="gradient-bg text-white py-3 px-8 rounded-xl font-bold">
              Kembali Berbelanja
            </button>
          </div>
        `;
      }, 1000);
    };

    // Enhanced renderStore function
    function renderStore() {
      document.getElementById('shopNameDisplay').innerText = storeData.name || "Itsbad Store";
      
      const grid = document.getElementById('productGrid');
      grid.innerHTML = "";
      
      if(storeData.products && storeData.products.length > 0) {
        document.getElementById('productCount').innerText = `${storeData.products.length} Produk`;
        
        storeData.products.forEach((p, i) => {
          const hasStock = parseInt(p.stock) > 0;
          const rating = (Math.random() * (5 - 4) + 4).toFixed(1); // Random rating 4.0-5.0
          
          grid.innerHTML += `
          <div class="bg-white p-4 rounded-2xl border border-slate-100 card-shadow flex flex-col h-full relative overflow-hidden slide-up fade-in" onclick="window.showProductDetail(${i})">
            ${!hasStock ? `
            <div class="absolute inset-0 bg-white/90 backdrop-blur-sm flex flex-col items-center justify-center font-bold z-10 p-4">
              <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mb-2">
                <i class="fas fa-times text-red-500 text-xl"></i>
              </div>
              <span class="text-red-500 text-sm">STOK HABIS</span>
            </div>` : ''}
            
            <div class="w-full h-40 bg-gradient-to-br from-indigo-50 to-blue-50 rounded-xl mb-4 flex items-center justify-center text-indigo-200 relative overflow-hidden">
              <i class="fas fa-box text-5xl"></i>
              ${hasStock && parseInt(p.stock) < 10 ? `
              <div class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold">
                Hampir Habis!
              </div>` : ''}
            </div>
            
            <h3 class="font-bold text-base text-slate-800 leading-tight mb-2 line-clamp-2">${p.name}</h3>
            <p class="text-sm text-slate-500 mb-3 truncate">${p.desc || 'Tidak ada deskripsi'}</p>
            
            <div class="mt-auto">
              <div class="flex items-center justify-between mb-3">
                <div>
                  <p class="font-bold text-indigo-600 text-lg">Rp ${parseInt(p.price).toLocaleString()}</p>
                  <div class="flex items-center gap-1 mt-1">
                    <i class="fas fa-star text-amber-400 text-xs"></i>
                    <span class="text-xs text-slate-500">${rating}</span>
                    <span class="text-xs text-slate-400">‚Ä¢ Stok: ${p.stock}</span>
                  </div>
                </div>
                <button onclick="event.stopPropagation(); window.addToCart(${i})" 
                  class="w-10 h-10 rounded-full gradient-bg text-white flex items-center justify-center hover:shadow-lg transition-all ripple ${!hasStock ? 'opacity-50 cursor-not-allowed' : ''}" 
                  ${!hasStock ? 'disabled' : ''}>
                  <i class="fas fa-plus text-sm"></i>
                </button>
              </div>
            </div>
          </div>`;
        });
      } else {
        grid.innerHTML = `
        <div class="col-span-2 text-center py-16">
          <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-box-open text-3xl text-slate-300"></i>
          </div>
          <h3 class="font-bold text-slate-600 mb-2">Belum ada produk</h3>
          <p class="text-slate-400 text-sm">Login sebagai admin untuk menambah produk</p>
        </div>`;
      }
      updateCartBadge();
    }

    // Enhanced renderCart function
    function renderCart() {
      const el = document.getElementById('cartItems');
      const itemCount = cart.reduce((a, b) => a + b.qty, 0);
      document.getElementById('cartItemCount').innerText = `${itemCount} item${itemCount !== 1 ? 's' : ''}`;
      
      el.innerHTML = "";
      let subtotal = 0;

      if(cart.length === 0) {
        el.innerHTML = `
        <div class="text-center text-slate-400 py-16">
          <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-shopping-bag text-2xl text-slate-300"></i>
          </div>
          <p class="font-medium text-slate-500">Keranjang belanja kosong</p>
          <p class="text-sm text-slate-400 mt-1">Tambahkan produk untuk memulai belanja</p>
        </div>`;
      } else {
        cart.forEach((c, i) => {
          subtotal += c.price * c.qty;
          el.innerHTML += `
          <div class="flex items-center bg-white p-4 rounded-2xl border border-slate-100 card-shadow slide-up">
            <div class="w-16 h-16 bg-gradient-to-br from-indigo-50 to-blue-50 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
              <i class="fas fa-box text-xl text-indigo-300"></i>
            </div>
            
            <div class="flex-1">
              <h4 class="font-bold text-sm text-slate-800 mb-1">${c.name}</h4>
              <p class="text-xs text-slate-500 mb-2">Rp ${c.price.toLocaleString()}</p>
              
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3 bg-slate-50 rounded-lg p-1">
                  <button onclick="window.updateQty(${i}, -1)" class="w-7 h-7 flex items-center justify-center text-slate-500 hover:bg-white rounded transition-all ripple">-</button>
                  <span class="text-sm font-bold w-6 text-center">${c.qty}</span>
                  <button onclick="window.updateQty(${i}, 1)" class="w-7 h-7 flex items-center justify-center text-slate-500 hover:bg-white rounded transition-all ripple">+</button>
                </div>
                <p class="font-bold text-slate-800">Rp ${(c.price * c.qty).toLocaleString()}</p>
              </div>
            </div>
          </div>`;
        });
      }

      const fee = parseInt(storeData.fee || 0);
      const total = subtotal + fee;
      
      document.getElementById('cartSubtotal').innerText = "Rp " + subtotal.toLocaleString();
      document.getElementById('cartFee').innerText = "+ Rp " + fee.toLocaleString();
      document.getElementById('cartTotal').innerText = "Rp " + total.toLocaleString();
    }

    // Enhanced processCheckout function
    window.processCheckout = () => {
      if(cart.length === 0) {
        toastr.warning("Keranjang belanja kosong!");
        return;
      }
      
      // Validate profile data for guest users
      if(user.isAnonymous && (!userProfile.phone || !userProfile.address)) {
        toastr.warning("Isi nomor WhatsApp dan alamat terlebih dahulu!");
        window.showProfile();
        window.toggleCart();
        return;
      }
      
      if(!userProfile.phone) {
        toastr.warning("Isi nomor WhatsApp di profil terlebih dahulu!");
        window.showProfile();
        window.toggleCart();
        return;
      }
      
      window.toggleCart();
      const subtotal = cart.reduce((a, b) => a + b.qty * b.price, 0);
      const fee = parseInt(storeData.fee || 0);
      const total = subtotal + fee;

      document.getElementById('payTotal').innerText = "Rp " + total.toLocaleString();
      document.getElementById('custName').value = userProfile.name || user.displayName || "Tamu";
      document.getElementById('custPhone').value = userProfile.phone || "";
      
      document.getElementById('paymentModal').classList.remove('hidden');
      document.getElementById('paymentModal').classList.add('flex');
      
      generateQR(total);
    };

    // Rest of your Firebase initialization and functions remain the same...
    // (Only UI/UX enhancements and file upload removal)
    
    // Initialize Firebase
    try {
      const app = initializeApp(firebaseConfig);
      db = getDatabase(app);
      auth = getAuth(app);
      
      onAuthStateChanged(auth, (u) => {
        if (u) {
          user = u;
          document.getElementById('authOverlay').classList.add('hidden');
          loadUserProfile(u.uid);
          
          // Set initial display
          document.getElementById('userNameDisplay').innerText = userProfile.name || u.displayName || "Tamu";
          if(u.photoURL && !userProfile.avatar) {
            document.getElementById('userAvatar').innerHTML = `<img src="${u.photoURL}" class="w-full h-full object-cover rounded-full">`;
          }
          
          initStore();
          
          // Show admin panel if accessed via /?page=admin
          const urlParams = new URLSearchParams(window.location.search);
          if(urlParams.get('page') === 'admin') {
            setTimeout(() => {
              document.getElementById('adminPanel').classList.remove('hidden');
            }, 500);
          }
        } else {
          document.getElementById('authOverlay').classList.remove('hidden');
          document.getElementById('adminPanel').classList.add('hidden');
        }
      });

    } catch(e) { 
      console.error(e); 
      toastr.error("Koneksi Error: " + e.message);
    }

    // Your existing Firebase functions (loadUserProfile, updateProfileDisplay, etc.)
    // ... keep all your existing Firebase functions as they are ...

    // Export functions to window
    window.toggleCart = window.toggleCart;
    window.addToCart = window.addToCart;
    window.updateQty = window.updateQty;
    window.processCheckout = window.processCheckout;
    window.closePayment = window.closePayment;
    window.sendOrder = window.sendOrder;
    window.showProductDetail = window.showProductDetail;
    window.closeProductDetail = window.closeProductDetail;
    window.addToCartFromDetail = window.addToCartFromDetail;
    window.buyNowFromDetail = window.buyNowFromDetail;
    window.showProfile = window.showProfile;
    window.saveProfile = window.saveProfile;
    window.logout = window.logout;
    window.loginAdmin = window.loginAdmin;
    window.saveSettings = window.saveSettings;
    window.addProduct = window.addProduct;
    window.delProd = window.delProd;
    window.loginGoogle = window.loginGoogle;
    window.loginGuest = window.loginGuest;

  </script>
</body>
</html>
